Column {data-width=205}
----------

### Options and Notes

```{r}
inputPanel(
    selectInput(
        inputId = "shipType",
        label = "Vessel Type",
        choices = names(main$shipTypeName)
    ),
    selectInput(
        inputId = "shipName",
        label = "Vessel Name",
        choices = main$shipTypeName[[1]]$ShipName
    )
)
```

```{r}
observeEvent(
    eventExpr = input$shipType,
    handlerExpr = {
        x <- main$shipTypeName[[input$shipType]]$ShipName
        updateSelectInput(
            session = session,
            inputId = "shipName",
            choices = x
        )
    }
)
```

```{r}
shipSelected <- eventReactive(
    eventExpr = c(
        input$shipType,
        input$shipName
    ),
    valueExpr = {
        x <- main$shipMaxDist %>%
            filter(
                ShipType == input$shipType,
                ShipName == input$shipName
            )
        validate(
            need(
                expr = nrow(x) > 0,
                message = "Selection updating, please wait a moment."
            )
        )
        return(x)
    }
)
output$shipSelectedNote <- renderText(
    shipSelectedNoteCreate(shipSelected())
)
htmlOutput("shipSelectedNote")
```

Column {data-width=795}
----------

### Map

```{r}
output$shipSelectedMap <- renderLeaflet({
    x <- shipSelected()
    # get view center
    # if (!is.na(x$DistSinceLast_Meters)) {
    #     xvc <- c(
    #         (x$Lon + x$PreviousLon)/2,
    #         (x$Lat + x$PreviousLat)/2
    #     )
    # } else {
    #     xvc <- c(x$Lon, x$Lat)
    # }
    leaflet(data = x) %>%
        addProviderTiles("CartoDB.Positron") %>%
        addMarkers(
            lng = ~Lon,
            lat = ~Lat
        ) %>%
        addMarkers(
            lng = ~PreviousLon,
            lat = ~PreviousLat
        )
})
leafletOutput("shipSelectedMap")
```
